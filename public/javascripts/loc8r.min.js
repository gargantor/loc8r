angular.module("loc8rApp",["ngRoute","ngSanitize","ui.bootstrap"]),angular.module("loc8rApp").config(["$routeProvider","$locationProvider",function(t,o){t.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),o.html5Mode({enabled:!0,requireBase:!1})}]),function(){function t(o,n,t){"/"!==window.location.pathname&&(window.location.href="/#"+window.location.pathname);var r=this;r.pageHeader={title:"Loc8r",strapline:"Find place to work with wifi near you!"},r.sidebar={content:"Looking for wifi and seat etc etc"},r.message="Checking you location",r.getData=function(t){var o=t.coords.latitude,e=t.coords.longitude;r.message="Searching for nearby places",n.locationByCoords(o,e).then(function(t){r.message=0<t.data.length?"":"No locations found",r.data={locations:t.data}},function(t){console.log(t)})},r.showError=function(t){o.$apply(function(){r.message=t.message})},r.noGeo=function(){o.$apply(function(){r.message="Geolocation not supported by this browser."})},t.getPosition(r.getData,r.showError,r.noGeo)}t.$inject=["$scope","loc8rData","geolocation"],angular.module("loc8rApp").controller("homeCtrl",t)}(),function(){function t(t,o,e,n,r){var a=this;a.locationid=t.locationid,a.isLoggedIn=r.isLoggedIn(),a.currentPath=o.path(),n.locationById(a.locationid).then(function(t){a.data={location:t.data},a.pageHeader={title:a.data.location.name}},function(t){console.log(t)}),a.popupReviewForm=function(){e.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl",controllerAs:"vm",resolve:{locationData:function(){return{locationid:a.locationid,locationName:a.data.location.name}}}}).result.then(function(t){a.data.location.reviews.push(t)})}}t.$inject=["$routeParams","$location","$uibModal","loc8rData","authentication"],angular.module("loc8rApp").controller("locationDetailCtrl",t)}(),angular.module("loc8rApp").controller("aboutCtrl",function(){this.pageHeader={title:"About Loc8r"},this.main={content:"Loc8r was created to help people find places to sit down and get a bit of work done.\n\nLorem ipsum dolor sit amet, \n\nconsectetur \n\nadipiscing elit."}}),function(){function t(o,e,t){var n=this;n.locationData=t,n.modal={close:function(t){o.close(t)},cancel:function(){o.dismiss("cancel")}},n.onSubmit=function(){if(n.formError="",!(n.formData&&n.formData.rating&&n.formData.reviewText))return!(n.formError="All fields required, please try again");n.doAddReview(n.locationData.locationid,n.formData)},n.doAddReview=function(t,o){return e.addReviewById(t,{rating:o.rating,reviewText:o.reviewText}).then(function(t){console.log("Success!"),n.modal.close(t.data)},function(t){console.log(t),n.formError="Your review has not been saved, try again"}),!1}}t.$inject=["$uibModalInstance","loc8rData","locationData"],angular.module("loc8rApp").controller("reviewModalCtrl",t)}(),angular.module("loc8rApp").service("geolocation",function(){return{getPosition:function(t,o,e){navigator.geolocation?navigator.geolocation.getCurrentPosition(t,o):e()}}}),function(){var t;function t(e,n){return{locationByCoords:function(t,o){return e.get("/api/locations?lng="+o+"&lat="+t+"&maxDistance=200000")},locationById:function(t){return e.get("/api/locations/"+t)},addReviewById:function(t,o){return e.post("/api/locations/"+t+"/reviews",o,{headers:{authorization:"Bearer "+n.getToken()}})}}}t.$inject=["$http","authentication"],angular.module("loc8rApp").service("loc8rData",t)}(),function(){var t;function t(e,o){var n=function(t){console.log("do save token -> token : "+t),e.localStorage["loc8r-token"]=t},r=function(){return e.localStorage["loc8r-token"]},a=function(){var t=r();if(t)return JSON.parse(e.atob(t.split(".")[1])).exp>Date.now()/1e3};return{saveToken:n,getToken:r,register:function(t){return console.log("auth register"),o.post("/api/register",t).then(function(t){n(t.data.token)})},login:function(t){return o.post("/api/login",t).then(function(t){n(t.data.token)})},logout:function(){e.localStorage.removeItem("loc8r-token")},isLoggedIn:a,currentUser:function(){if(a()){var t=r(),o=JSON.parse(e.atob(t.split(".")[1]));return{email:o.email,name:o.name}}}}}t.$inject=["$window","$http"],angular.module("loc8rApp").service("authentication",t)}(),angular.module("loc8rApp").filter("formatDistance",function(){return function(t){var o,e,n;return t&&(n=t,!isNaN(parseFloat(n))&&isFinite(n))?(1e3<t?(o=parseFloat(t/1e3).toFixed(1),e="km"):(o=parseInt(t,10),e="m"),o+e):"?"}}),function(){function t(e){return function(t){var o=t.replace(/\n/g,"<br/>");return e.trustAsHtml(o)}}t.$inject=["$sce"],angular.module("loc8rApp").filter("addHtmlLineBreaks",t)}(),angular.module("loc8rApp").directive("ratingStars",function(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}),angular.module("loc8rApp").directive("footerGeneric",function(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}),angular.module("loc8rApp").directive("pageHeader",function(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}),angular.module("loc8rApp").directive("navigation",function(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl",controllerAs:"navvm"}}),function(){function t(t,o){this.currentPath=t.path(),this.isLoggedIn=o.isLoggedIn(),this.currentUser=o.currentUser(),this.logout=function(){o.logout(),t.path("/")}}t.$inject=["$location","authentication"],angular.module("loc8rApp").controller("navigationCtrl",t)}(),function(){function t(o,t){var e=this;e.pageHeader={title:"Create a new Loc8r account"},e.credentials={name:"",email:"",password:""},e.returnPage=o.search().page||"/",e.onSubmit=function(){if(e.formError="",!(e.credentials.name&&e.credentials.email&&e.credentials.password))return!(e.formError="All fields required, please try again");e.doRegister()},e.doRegister=function(){e.formError="",t.register(e.credentials).then(function(t){o.search("page",null),o.path(e.returnPage)},function(t){e.formError=t.data.message})}}t.$inject=["$location","authentication"],angular.module("loc8rApp").controller("registerCtrl",t)}(),function(){function t(o,t){var e=this;e.pageHeader={title:"Sign in to Loc8r"},e.credentials={email:"",password:""},e.returnPage=o.search().page||"/",e.onSubmit=function(){if(e.formError="",!e.credentials.email||!e.credentials.password)return!(e.formError="All fields required, please try again");e.doLogin()},e.doLogin=function(){e.formError="",console.log("do login"),t.login(e.credentials).then(function(t){o.search("page",null),o.path(e.returnPage)},function(t){e.formError=t.data.message})}}t.$inject=["$location","authentication"],angular.module("loc8rApp").controller("loginCtrl",t)}();